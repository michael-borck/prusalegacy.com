<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Michael Borck">

<title>Prusa Legacy Update Hub</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Prusa Legacy Update Hub</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-about" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">About</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-about">    
        <li>
    <a class="dropdown-item" href="../about/site.html">
 <span class="dropdown-text">Site</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../about/founder.html">
 <span class="dropdown-text">Founder</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-d-printers" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">3D Printers</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-d-printers">    
        <li>
    <a class="dropdown-item" href="../printers/mk3.html">
 <span class="dropdown-text">Prusa i3 MK3/S/+</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../printers/mk2.html">
 <span class="dropdown-text">Prusa MK2/2.5S/3S</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../printers/mini.html">
 <span class="dropdown-text">Prusa MINI+</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../printers/clones.html">
 <span class="dropdown-text">Clones</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../materials.html"> 
<span class="menu-text">Materials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../software.html"> 
<span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../firmware.html"> 
<span class="menu-text">Firmware</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../community.html"> 
<span class="menu-text">Community</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#mmu1-pros-and-cons" id="toc-mmu1-pros-and-cons" class="nav-link active" data-scroll-target="#mmu1-pros-and-cons">MMU1: Pros and Cons</a></li>
  <li><a href="#mmu2mmu2s-key-issues" id="toc-mmu2mmu2s-key-issues" class="nav-link" data-scroll-target="#mmu2mmu2s-key-issues">MMU2/MMU2S: Key Issues</a></li>
  <li><a href="#mmu3-major-improvements" id="toc-mmu3-major-improvements" class="nav-link" data-scroll-target="#mmu3-major-improvements">MMU3: Major Improvements</a></li>
  <li><a href="#overall-evolution-and-enhancements" id="toc-overall-evolution-and-enhancements" class="nav-link" data-scroll-target="#overall-evolution-and-enhancements">Overall Evolution and Enhancements</a></li>
  <li><a href="#comparative-analysis-mmu1-vs-mmu2-vs-mmu3" id="toc-comparative-analysis-mmu1-vs-mmu2-vs-mmu3" class="nav-link" data-scroll-target="#comparative-analysis-mmu1-vs-mmu2-vs-mmu3">Comparative Analysis: MMU1 vs MMU2 vs MMU3</a></li>
  <li><a href="#material-compatibility-and-performance" id="toc-material-compatibility-and-performance" class="nav-link" data-scroll-target="#material-compatibility-and-performance">Material Compatibility and Performance</a></li>
  <li><a href="#firmware-and-software-updates" id="toc-firmware-and-software-updates" class="nav-link" data-scroll-target="#firmware-and-software-updates">Firmware and Software Updates</a></li>
  <li><a href="#impact-on-print-quality" id="toc-impact-on-print-quality" class="nav-link" data-scroll-target="#impact-on-print-quality">Impact on Print Quality</a></li>
  <li><a href="#setup-and-calibration-differences" id="toc-setup-and-calibration-differences" class="nav-link" data-scroll-target="#setup-and-calibration-differences">Setup and Calibration Differences</a></li>
  <li><a href="#mmu-upgrade-kit" id="toc-mmu-upgrade-kit" class="nav-link" data-scroll-target="#mmu-upgrade-kit">MMU Upgrade Kit</a></li>
  <li><a href="#user-feedback-and-community-contributions" id="toc-user-feedback-and-community-contributions" class="nav-link" data-scroll-target="#user-feedback-and-community-contributions">User Feedback and Community Contributions</a></li>
  <li><a href="#future-of-multi-material-printing" id="toc-future-of-multi-material-printing" class="nav-link" data-scroll-target="#future-of-multi-material-printing">Future of Multi-Material Printing</a></li>
  <li><a href="#sources-and-citations" id="toc-sources-and-citations" class="nav-link" data-scroll-target="#sources-and-citations">Sources and Citations</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Michael Borck </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://blog.prusa3d.com/wp-content/uploads/2023/07/1.-MMU3-celek-3-640x360.jpg" class="img-fluid figure-img"></p>
<figcaption>MMU3, blog.prusa3d.com</figcaption>
</figure>
</div>
<p>The Prusa Multi Material Upgrade (MMU) has significantly transformed the landscape of consumer-grade 3D printing by enabling multi-color and multi-material prints with a single nozzle. Since its debut in 2016, the MMU has evolved through three major iterations, each addressing user feedback and technological advancements. This page delves into the journey from the experimental MMU1 to the refined MMU3, examining the pros and cons of each version, key improvements, material compatibility, firmware updates, and the vital role of user feedback. As Prusa continues to refine this technology, the MMU has become more reliable, user-friendly, and versatile, opening new possibilities for 3D printing enthusiasts and professionals alike.</p>
<section id="mmu1-pros-and-cons" class="level2">
<h2 class="anchored" data-anchor-id="mmu1-pros-and-cons">MMU1: Pros and Cons</h2>
<p>Released in 2016, this pioneering add-on for the Prusa i3 MK2 printer supported up to four different filaments, marking Prusa’s first foray into multi-material printing[1]. While it proved the concept and laid groundwork for future iterations, the MMU1 faced significant challenges:</p>
<p>• Experimental nature led to reliability issues • Complex mechanical system using servos • Frequent failures and jams • Complicated setup and maintenance • Limited software integration and availability</p>
<p>Despite these drawbacks, the MMU1 provided valuable insights that would shape the development of more refined versions in the years to come[1][2].</p>
</section>
<section id="mmu2mmu2s-key-issues" class="level2">
<h2 class="anchored" data-anchor-id="mmu2mmu2s-key-issues">MMU2/MMU2S: Key Issues</h2>
<p>Released in 2018, with an update to MMU2S in 2019, this iteration addressed many issues of its predecessor but still faced challenges:</p>
<p>• Complex filament path led to frequent jams • Unreliable buffer mechanism caused loading issues • Limited firmware and software integration • Noisy operation during filament changes • Required significant troubleshooting and maintenance</p>
<p>Despite these problems, the MMU2/MMU2S supported up to five filaments and enabled complex, multi-color prints when functioning correctly. It also fostered a community of users who developed modifications and improvements, contributing to its evolution[1][2].</p>
</section>
<section id="mmu3-major-improvements" class="level2">
<h2 class="anchored" data-anchor-id="mmu3-major-improvements">MMU3: Major Improvements</h2>
<p>Released in 2023, the MMU3 represents a significant redesign that addresses many of the issues faced by its predecessors. Key improvements include:</p>
<p>• Simplified filament path and new cutting mechanism for reduced jams • Enhanced sensor system for accurate filament detection • Faster filament changes (up to 2x faster than MMU2S) • Expanded material compatibility, including flexible filaments • Quieter operation and improved firmware integration</p>
<p>While limited to four filaments instead of five, the MMU3 offers substantially improved reliability and ease of use, making it more accessible to a wider range of users[1][2]. The redesign also requires more vertical space for installation, but the trade-off in performance and reduced maintenance needs has been well-received by the 3D printing community[3].</p>
</section>
<section id="overall-evolution-and-enhancements" class="level2">
<h2 class="anchored" data-anchor-id="overall-evolution-and-enhancements">Overall Evolution and Enhancements</h2>
<p>From the experimental MMU1 to the refined MMU3, significant advancements have been made in reliability, user-friendliness, and performance. Key improvements include:</p>
<p>• Simplified setup and calibration processes • Enhanced software integration for improved efficiency • Expanded material compatibility, including flexible filaments • Reduced noise levels during operation • Faster filament changes, leading to reduced print times</p>
<p>These enhancements demonstrate Prusa’s commitment to addressing user feedback and pushing the boundaries of consumer-grade multi-material 3D printing technology[1][2]. While the reduction from five to four filaments in the MMU3 might seem like a step back, the overall improvements in reliability and ease of use make it a significant upgrade over its predecessors[3].</p>
</section>
<section id="comparative-analysis-mmu1-vs-mmu2-vs-mmu3" class="level2">
<h2 class="anchored" data-anchor-id="comparative-analysis-mmu1-vs-mmu2-vs-mmu3">Comparative Analysis: MMU1 vs MMU2 vs MMU3</h2>
<p>The evolution of Prusa’s Multi Material Upgrade (MMU) has seen significant improvements across generations. The MMU1, while pioneering, was experimental and faced reliability issues. The MMU2/MMU2S increased material capacity to five filaments but still struggled with jams and complex setup. The latest MMU3 represents a major leap forward in reliability and user-friendliness[1][2]. It offers faster filament changes, a simplified filament path, and improved compatibility with various materials, including flexible filaments[3]. While reducing capacity to four filaments, the MMU3’s enhanced performance, quieter operation, and easier maintenance make it a substantial upgrade over its predecessors[2][3]. This progression demonstrates Prusa’s commitment to refining their multi-material printing technology based on user feedback and technological advancements.</p>
</section>
<section id="material-compatibility-and-performance" class="level2">
<h2 class="anchored" data-anchor-id="material-compatibility-and-performance">Material Compatibility and Performance</h2>
<p>The MMU3 offers improved material compatibility and performance compared to its predecessors. It supports a wide range of filaments including PLA, ABS, PETG, and soluble materials like BVOH and PVA[1]. The unit performs best with PLA on a 0.4mm nozzle, achieving nearly perfect results[4]. However, challenges may arise when using mixed materials or PETG[4]. The MMU3’s redesigned filament path and cutting mechanism help reduce jams and improve reliability across different materials[2]. For optimal performance, users should ensure proper calibration and may need to fine-tune settings for specific filament types. The expanded material compatibility, including support for flexible filaments, opens up new possibilities for multi-material printing projects[3][4].</p>
</section>
<section id="firmware-and-software-updates" class="level2">
<h2 class="anchored" data-anchor-id="firmware-and-software-updates">Firmware and Software Updates</h2>
<p>Firmware and software updates play a crucial role in the performance and functionality of the Prusa MMU3. Regular updates are recommended for all users as they bring new features and fixes[1]. To update the MMU3 firmware, users can follow a process similar to updating the printer firmware, but with some key differences:</p>
<ol type="1">
<li>Connect a USB cable directly to the MMU3 unit</li>
<li>Use the correct hex file specifically designed for the MMU3[2]</li>
</ol>
<p>The latest firmware version for the MMU3 is 3.0.3, which is compatible with the Original Prusa MK4 and MK3.9 printers[5]. This version must be paired with printer firmware version 6.0.0-RC1 for optimal performance[5]. It’s important to note that firmware compatibility varies between printer models, and users should ensure they are using the correct version for their specific setup[3][4].</p>
<p>Prusa provides detailed instructions for updating the firmware through their Knowledge Base and regularly releases new versions to address issues and improve functionality[1][4]. By keeping the MMU3 firmware up to date, users can benefit from enhanced reliability, new features, and improved compatibility with various materials and printing configurations.</p>
</section>
<section id="impact-on-print-quality" class="level2">
<h2 class="anchored" data-anchor-id="impact-on-print-quality">Impact on Print Quality</h2>
<p>The impact of the Prusa MMU on print quality varies depending on several factors. When functioning correctly, the MMU generally does not significantly affect print quality for single-filament prints[1]. However, multi-material prints can present some challenges:</p>
<ol type="1">
<li>Color bleeding may occur at filament transition points, especially with materials that have different melting temperatures[4].</li>
<li>Proper calibration is crucial to maintain print quality, particularly when using different materials[4].</li>
<li>For PLA prints with a 0.4mm nozzle, the MMU3 can achieve nearly perfect results[5].</li>
</ol>
<p>Some users have reported occasional issues such as missed layers due to filament loading problems, but these are typically resolved through proper setup and maintenance[1][4]. The MMU3’s improved design and firmware have addressed many previous quality concerns, leading to more consistent and reliable multi-material prints[2][5]. However, users should be prepared to fine-tune settings and potentially troubleshoot to achieve optimal print quality across different materials and color combinations.</p>
</section>
<section id="setup-and-calibration-differences" class="level2">
<h2 class="anchored" data-anchor-id="setup-and-calibration-differences">Setup and Calibration Differences</h2>
<p>The setup and calibration process for Prusa MMU units has evolved significantly across versions, with the MMU3 offering notable improvements in user-friendliness. For the MMU2S, calibration involved setting up two crucial sensors: the IR filament sensor on the extruder and the SuperFINDA sensor on the MMU unit[1]. Users needed to ensure proper triggering of these sensors, visible in the printer’s LCD menu under “Support -&gt; Sensor info”[1]. The MMU2S also required careful adjustment of idler screws and proper positioning of spool holders[1].</p>
<p>In contrast, the MMU3 setup process has been streamlined, particularly for the MK4 printer. It includes a dedicated calibration routine for both the filament sensor and the SuperFINDA sensor[3]. The MMU3 uses a PTFE tube with a larger 2.5mm internal diameter, improving filament movement[3]. Additionally, the MMU3 firmware is not compatible with older PrusaSlicer profiles or G-codes from previous versions, necessitating updated software for proper functionality[3]. These improvements in the MMU3 setup and calibration process aim to reduce user frustration and improve overall reliability, addressing key pain points from earlier versions[2][3].</p>
</section>
<section id="mmu-upgrade-kit" class="level2">
<h2 class="anchored" data-anchor-id="mmu-upgrade-kit">MMU Upgrade Kit</h2>
<p>The upgrade kit from Prusa for MMU2S to MMU3 includes several key components to enhance the functionality and reliability of the multi-material unit. The package contains a PD Addon board with power/data cable, 2x 400g of filament, selected printed parts (label-plate, selector-front-plate), PTFE tubes, fasteners, and extruder parts[3][4]. The upgrade is designed to be compatible with various Prusa printer models, including the MK3S+, MK3.5, and MK4[3][4][5].</p>
<p>Notably, the upgrade kit does not include all plastic parts; users are required to print some components themselves[3][4]. The kit focuses on providing the essential hardware and electronics needed for the upgrade, including more robust metal parts and improved electronics[3][4]. This approach allows for easier assembly and maintenance while making the unit more reliable. The upgrade also introduces a completely new firmware, written from scratch, which enables full two-way communication with the printer and LCD screen integration for improved status monitoring and error reporting[3][4][5].</p>
</section>
<section id="user-feedback-and-community-contributions" class="level2">
<h2 class="anchored" data-anchor-id="user-feedback-and-community-contributions">User Feedback and Community Contributions</h2>
<p>The Prusa MMU community has played a significant role in shaping the evolution of the device through user feedback and contributions. Many users have reported spending considerable time fine-tuning their MMU setups to achieve reliable performance[2]. For example, one user mentioned achieving a 99.7% success rate with 878 filament changes after initial troubleshooting[2]. The community has also developed modifications and improvements, some of which have been incorporated into official updates by Prusa Research[4].</p>
<p>However, user experiences vary widely. While some report high reliability after optimization, others have found the learning curve steep and frustrating[2][3]. This feedback has driven Prusa to make significant improvements in the MMU3, such as the redesigned buffer and larger PTFE tubes to reduce jamming issues[4]. The company has also implemented community-inspired features like the automatic filament cutting mechanism to address common problems[4].</p>
<p>Despite improvements, some users still express concerns about the MMU’s complexity compared to other multi-material solutions[2]. This ongoing dialogue between users and Prusa continues to drive innovation and refinement in the MMU technology[3][4].</p>
</section>
<section id="future-of-multi-material-printing" class="level2">
<h2 class="anchored" data-anchor-id="future-of-multi-material-printing">Future of Multi-Material Printing</h2>
<p>The evolution of Prusa’s Multi Material Upgrade (MMU) from MMU1 to MMU3 demonstrates significant progress in multi-material 3D printing technology. The MMU3 represents a major leap forward, addressing many of the reliability issues and user frustrations associated with earlier versions[3]. Key improvements include a simplified filament path, faster filament changes, and expanded material compatibility[2][3].</p>
<p>While the MMU3 reduced capacity from five to four filaments, it offers substantially improved performance and ease of use. The redesigned buffer, larger PTFE tubes, and automatic filament cutting mechanism have greatly reduced jamming issues and improved overall reliability[4]. User feedback has played a crucial role in shaping these advancements, with Prusa incorporating community-inspired features and modifications[4].</p>
<p>Despite these improvements, users should still expect a learning curve and potential need for fine-tuning, especially when working with different materials[2][5]. However, the MMU3’s enhanced firmware, quieter operation, and simplified setup process make it more accessible to a wider range of users, setting a new standard for consumer-grade multi-material 3D printing[1][3].</p>
</section>
<section id="sources-and-citations" class="level2">
<h2 class="anchored" data-anchor-id="sources-and-citations">Sources and Citations</h2>
<p>[1] https://forum.prusa3d.com/forum/original-prusa-i3-mmu2s-mmu2-hardware-firmware-and-software-help/mmu2-evolution/</p>
<p>[2] https://blog.prusa3d.com/original-prusa-i3-mk3s-and-mmu2s-release-sl1-and-powder-coated-sheets-update_29599/</p>
<p>[3] https://forum.prusa3d.com/forum/original-prusa-i3-mmu2s-mmu2-general-discussion-announcements-and-releases/thoughts-on-mmu2-from-experienced-mmu1-users/</p>
<p>[4] https://help.prusa3d.com/guide/4-upgrading-to-mmu2s_65000</p>
<p>[5] https://forum.prusa3d.com/forum/original-prusa-i3-mmu2s-mmu2-general-discussion-announcements-and-releases/exploit-mmu-1-after-upgrade-to-mmu-2/</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/prusalegacy\.com\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>